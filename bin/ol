#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os, sys ; sys.path.insert(0, "lib")

from fnd import fnd
from hdl import Client, cmd
from nms import Names
from obj import Object, cfg
from tbl import table
from trm import exec
from zzz import os, sys

__version__ = 1

class Console(Client):

    prompt = True

    def handle(self, e):
        super().handle(e)
        e.wait()

    def poll(self):
        if Console.prompt:
            return input("> ")

    def raw(self, txt):
        sys.stdout.write(txt)
        sys.stdout.write("\n")
        sys.stdout.flush()

class Log(Object):

    Names.names["log"] = "__main__.Log"

    def __init__(self):
        super().__init__()
        self.txt = ""

def log(event):
    if not event.rest:
        event.reply("log <txt>")
        return
    o = Log()
    o.txt = event.rest
    o.save()
    event.reply("ok")

def ver(event):
    event.reply("OLIB %s" % __version__)

def main():
    Names.tbl(table)
    cfg.name = "ol"
    cfg.version = __version__
    cfg.wd = os.path.expanduser("~/.olib")
    c = Console()
    c.boot()
    c.add("log", log)
    c.add("fnd", fnd)
    c.add("ver", ver)
    if cfg.txt:
        c.prompt = False
        e = c.event(cfg.otxt)
        cmd(c, e)
        e.wait()
        return
    if cfg.mods:
        c.start()
        c.init(cfg.mods)
        c.wait()

exec(main)

#!/usr/bin/env python3
# This file is placed in the Public Domain.

__version__ = 120

import os
import importlib
import sys

sys.path.insert(0, "mod")

from hdl import Client, boot, docmd, reg
from obj import cfg
from nms import Names, findnames
from trm import exec
from utl import mods, spl

class CLI(Client):

    def handle(self, e):
        super().handle(e)
        e.wait()

    def raw(self, txt):
        print(txt)

    @staticmethod
    def scan(mns):
        for mn in spl(mns):
            mod = importlib.import_module(mn)
            Names.names.update(findnames(mod))
            reg(mn)

def ver(event):
    event.reply("OL %s" % __version__)

def main():
    boot("ol", os.path.expanduser("~/.olib"))
    cfg.version = __version__
    c = CLI()
    c.add("ver", ver)
    c.scan(mods("mod"))
    e = c.event(cfg.otxt)
    docmd(c, e)
    e.wait()

exec(main)
